<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Semantic Search — History Pages</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:#f6f7fb; color:#111; padding:24px; }
    .container { max-width:900px; margin:0 auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 6px 20px rgba(0,0,0,0.06); }
    h1 { margin:0 0 8px; font-size:20px; }
    p.lead { margin:0 0 16px; color:#666; }
    .controls { display:flex; gap:8px; margin-bottom:12px; }
    input[type="text"]{ flex:1; padding:10px 12px; border:1px solid #ddd; border-radius:8px; }
    button { padding:10px 14px; background:#2563eb; color:#fff; border:none; border-radius:8px; cursor:pointer; }
    button:disabled { opacity:0.6; cursor:default; }
    .result { border-top:1px solid #eee; padding:12px 0; display:flex; justify-content:space-between; gap:12px; }
    .meta { width:120px; text-align:right; color:#666; font-size:13px; }
    .title { font-weight:600; margin-bottom:6px; }
    .summary { color:#333; white-space:pre-wrap; }
    .small { font-size:13px; color:#666; }
    .footer { margin-top:16px; font-size:13px; color:#888; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Semantic Search — History Pages</h1>
    <p class="lead">Enter a query and click search. Top 10 results (by relevance) will appear below.</p>

    <div class="controls">
      <input id="q" type="text" placeholder="Ask something about history..." />
      <button id="searchBtn">Search</button>
    </div>

    <div style="margin-bottom:8px;">
      <label class="small"><input id="showEmbedding" type="checkbox" /> Include embeddings (large)</label>
    </div>

    <div id="status" class="small"></div>
    <div id="results" style="margin-top:14px;"></div>

    <div class="footer">Backend endpoint: <code id="backendUrl">http://localhost:8000/search</code>. Make sure backend is running.</div>
  </div>

<script>
const backend = "http://127.0.0.1:8000/search"; // change if your backend runs elsewhere
document.getElementById('backendUrl').textContent = backend;

const qInput = document.getElementById('q');
const btn = document.getElementById('searchBtn');
const resultsEl = document.getElementById('results');
const status = document.getElementById('status');
const showEmbeddingEl = document.getElementById('showEmbedding');

async function doSearch() {
  const q = qInput.value.trim();
  if (!q) return;
  btn.disabled = true;
  status.textContent = "Searching...";
  resultsEl.innerHTML = "";

  try {
    const payload = { query: q, limit: 10, show_embedding: showEmbeddingEl.checked };
    const res = await fetch(backend, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    if (!res.ok) {
      const txt = await res.text();
      throw new Error(`Server error ${res.status}: ${txt}`);
    }

    const j = await res.json();
    const rows = j.results || [];
    status.textContent = `Returned ${rows.length} result(s).`;
    if (rows.length === 0) {
      resultsEl.innerHTML = `<div class="small">No results found.</div>`;
    } else {
      rows.forEach((r, i) => {
        const item = document.createElement('div');
        item.className = "result";

        const left = document.createElement('div');
        left.style.flex = "1";
        const title = document.createElement('div');
        title.className = "title";
        title.textContent = `${i+1}. ${r.title || "(no title)"}`;
        const summary = document.createElement('div');
        summary.className = "summary";
        summary.textContent = r.ai_summary || r.summary || "(no summary)";
        left.appendChild(title);
        left.appendChild(summary);

        const right = document.createElement('div');
        right.className = "meta";
        const score = document.createElement('div');
        score.innerHTML = `<div class="small">score</div><div>${(typeof r.score === 'number') ? r.score.toFixed(6) : r.score}</div>`;
        right.appendChild(score);

        item.appendChild(left);
        item.appendChild(right);

        // optionally show embedding preview
        if (showEmbeddingEl.checked && r.embedding) {
          const embPreview = document.createElement('pre');
          embPreview.style = "background:#fafafa;padding:8px;border-radius:6px;margin-top:8px;font-size:12px;max-height:140px;overflow:auto;";
          embPreview.textContent = JSON.stringify(r.embedding.slice(0,50)) + (r.embedding.length>50 ? " ...": "");
          left.appendChild(embPreview);
        }

        resultsEl.appendChild(item);
      });
    }
  } catch (err) {
    status.textContent = "Error: " + err.message;
  } finally {
    btn.disabled = false;
  }
}

btn.addEventListener('click', doSearch);
qInput.addEventListener('keydown', e => { if (e.key === 'Enter') doSearch(); });

// focus the input on load
qInput.focus();
</script>
</body>
</html>
